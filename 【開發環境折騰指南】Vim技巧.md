---
title: 【開發環境折騰指南】Vim 技巧
zhihu-title-image: img/Develop_Environment-Practical_Vim/0.png
zhihu-tags: Vim, 文本编辑器
zhihu-url: https://zhuanlan.zhihu.com/p/500286670
---
總結一些Vim的用法，來自《Vim实用技巧》[^1]。

!!!注意：本文是《Vim实用技巧》[^1]的學習筆記，非常不適合還沒入門Vim的朋友用來儅教程。

有空最好做個cheat sheet。這裏有個[不錯的參考](https://vim.rtorr.com/lang/zh_cn)[^3]。

## 1. 重複操作的簡化

“.”命令用於重複上次的修改。與大多數文本編輯器不同，Vim中Normal模式是“本位”，其他模式（包括Insert模式）是這個“本位”的輔助， 或者乾脆別叫模式，叫子功能更好。而Normal模式中的基本命令又可被分爲移動和修改，“.”命令所重複的修改就是指Normal模式下的修改。

Vim裏還支持錄製宏命令：qx開始錄製，q停止錄製，@x執行操作。爲了方便，我把T映射為qx，t映射為@x，使用時只需要Tqt三個鍵。

```vimrc
noremap T qx
noremap t @x
```

### 1.1 重複操作中常用的移動

所謂的**移動**本質是對光標位置的改變。四個方向鍵是移動，Visual模式是移動，跳轉至指定符號也是移動。

這裏著重提一下**f操作和星號操作**，f加一個指定字符，會跳轉至下一個匹配項。

執行f操作後，按“;”可繼續跳轉至下一個所找字符或字符組，按“,”可跳轉至上一個所找字符或字符組。

另一個更好用的查找操作是“\*”操作，跟f操作類似，只不過它查找的是光標所在的整個單詞。执行“*”操作后，按n可跳轉至下一個匹配項，按N可跳轉至上一個匹配項。“\*”操作在執行第一次后會自動跳轉到下一個匹配項，但是往往我們想改單詞的時候不想從下一個開始，所以我把F映射為\*N，一方面解決了\*不太容易夠到的問題，另一方面想查找修改的時候不會從自動跳轉到第二個匹配項。

```vimrc
" find word and without jumping to next
noremap F *N
```

### 1.2 重複操作中常用的修改

所有對光標所在位置進行的修改都可算作一次**修改**。之所以强調“一次”是因爲在Vim裏，從進入Insert模式到退出Insert模式，不管加多少字符都算作一次。Delete操作雖然一次只刪一個字符（在沒框選多個字符的情況下），也算作一次修改。

Vim中常用的撤銷（undo）和取消撤銷（redo）用u和Ctrl-r實現，操作對象就是上述的一次修改。

值得注意的是，很多修改命令都自帶跳轉功能，比如A會跳到句尾進入Insert模式，I會跳到句末進入Insert模式，o會在下一行新建一行進入Insert模式，O會在上一行新建一行進入Insert模式。擅用自帶移動功能的修改操作會讓“.”操作更强。

在構建需要重複的修改時最好考慮好修改的可重複性，以降低移動操作的複雜度，比如daw操作，不僅在單詞所有地方都能順利執行（靈活性），而且刪除時連上一個空格也刪了，甚至都用不着移動就能繼續用“.”直接繼續刪除上一個單詞。當然daw算是個特殊情況，在一般的情況下，我們要盡量把移動部分的成本降到最低。

## 2. 模式

### 2.1 Normal模式

就像上文提到的，Normal模式是Vim裏的本位，Vim使用者在停下思考時會習慣性地按下Esc鍵回到Normal模式，就像畫家停下時會移開畫筆。由於要頻繁使用Esc鍵，而Esc鍵位置偏遠，所以很多人會把別的鍵映射為Esc，比如連按兩下f。我的做法是把右Alt鍵在操作系統層面改成Esc鍵，因爲hhkb鍵盤上的右Alt鍵位置相當方便，用小拇指指根一碰就行。

#### 直接加減

把光標移動到某個數字的任何位置（可用f操作快速跳轉），然後**鍵入<數>Ctrl-a即可直接把數字加到光標所在數字上**，類似的**鍵入<數>Ctrl-x可直接將光標所在數字減去指定數值**。這個操作牛就牛在，就算光標所在位置不是數字，它也會往下自動查找第一個數字，將操作執行到位。

#### 操作粒度

在撤回和重複時，操作對象是一次修改，這就意味著不管這次修改規模有多大，都會被當作一個整體。一方面，這提醒我們，**經常退回到Normal模式是一個好習慣**，另一方面，由於使用帶次數的命令時操作會被當作一個整體，不利於撤回和重複，所以**盡量用重複取代帶次數的命令**。

#### 操作符

一部分修改操作的後面要加動作{motion}，這種修改被稱爲**操作符（Operator）**。比如d、c、y。

### 2.2 插入模式（Insert Mode）

#### 高級刪除

- 刪除上一個單詞 Ctrl-w
- 刪除至行首 Ctrl-u

#### 插入模式内粘貼

用y操作複製到寄存器的文本，可以在插入模式内用 Ctrl+r 0 直接粘貼。這裏的0是寄存器的名字。

#### 替換模式

在Normal模式下按R，或在Insert模式下按insert可進入替換模式。需要連續修改一些東西的時候比較有用。

### 2.3 可視模式（Visual Mode）

可視模式相當於用鼠標拖拽選中。先把光標移動到想選的文本的開頭，按v進入可視模式，然後再移動光標，被選中的文本會變高亮，這時進行一些操作，如刪除、複製，操作對象就是被選中的部分。

#### 基本操作

- 小寫v選中字符，**大寫V選中行**。
- gv可以重選上次的選中區域。
- 用o可以切換高亮選區的活動端。

#### 縮進操作

Visual模式經常用於多行縮進。先用 V 選中待縮進的各行，然後按<向左縮進，按>向右縮進。儘管縮進操作可以用次數修飾，但用“.”重複縮進更好。

#### 能用操作符實現的命令盡量別用Visual模式

相對而言Visual模式不太靈活，在跟重複和刪除相關的操作過程中有可能出問題。

#### 列塊可視模式

按 Ctrl-v 可進入列塊Visual模式，在這種模式下光標可**按列**而不是按行**選中文本**。

在列塊Visual模式下，每行都有個光標，這意味著你**用s操作或c操作時可同時在選中的多行修改並插入新内容**。另外，原來的i和a是失效的，但**用I和A時，相當於同時對多行執行i和a的操作**。利用這一點可以在選中多行后按$使所有行的光標移動到行末，然後按A同時在幾行的行末添加内容。

### 2.4 命令行模式

也就是以冒號爲開頭的那些指令（Ex命令）。我現在用 VS Code Vim 插件，用不到了，所以就略過了。（略過不等於不重要，Ex命令對原生Vim使用者還是很重要的）另外，原書[^1]第六章和第七章也被我跳過了，原因同上。

## 3. 文件内移動

#### 光標移動

我覺得這部分太基礎了，沒啥好説的。可能還值得一説的是我覺得hjkl多少有點反人類，我映射成了ikjl，把大小寫Hh映射為Ii，算是解決了這個問題。還裝了個VS Code插件，叫Code Faster Keymap[^2]，這個插件把Alt+i/k/j/l映射為了上下左右，使VS Code Vim能在Insert模式下在手不離字母區的前提下到處走，還不耽誤用VS Code自帶的代碼補全，美滋滋。這個插件還實現了很多別的很好用的快捷鍵，具體可以看文末的參考[^2]。

#### 跳轉至定義

一些語言服務器（不太確定中文怎麽叫）可使編輯器帶跳轉到定義的功能，在Normal模式下將光標移動到變量名或函數名下，按 Ctrl+] 可跳到該變量/函數的定義。我覺得D原功能沒啥用就把D映射給 Ctrl+] 了。

```vimrc
noremap D <C-]>
```

## 4. 個人設置總結（vimrc設定）

```vimrc
" edit
noremap h i
noremap H I
noremap T qx
noremap t @x

" move cursor
noremap j h
noremap J 6h
noremap i k
noremap I 6k
noremap k j
noremap K 6j
noremap L 6l

" find word and without jumping to next
noremap F *N

" show the defination
noremap D <C-]>

" save and quit
noremap S :wq<CR>
noremap <C-s> :w<CR>
noremap Q :q<CR>
```

[^1]: NEIL, Drew. Practical Vim: Edit Text at the Speed of Thought. Pragmatic Bookshelf, 2015.
[^2]: https://marketplace.visualstudio.com/items?itemName=LeartMorina.CodeFasterKeymap Code Faster Keymap
[^3]: https://vim.rtorr.com/lang/zh_cn Vim Cheat Sheet 中文版